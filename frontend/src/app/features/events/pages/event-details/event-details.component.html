<ng-container *ngIf="vm$ | async as vm">

  <div *ngIf="vm.isLoading" class="loading-spinner">
    <mat-spinner></mat-spinner>
  </div>

  <div *ngIf="!vm.isLoading && vm.event" class="details-container">

    <div class="main-content">
      <a routerLink="/events" class="back-link">
        <mat-icon>arrow_back</mat-icon>
        <span>Back to all events</span>
      </a>
      <h1 class="event-title">{{ vm.event.name }}</h1>
      <p class="event-description">{{ vm.event.description }}</p>
      <div class="event-meta">
        <div class="meta-item"><mat-icon>calendar_today</mat-icon><span>{{ vm.event.date | date:'fullDate' }}</span></div>
        <div class="meta-item"><mat-icon>schedule</mat-icon><span>{{ vm.event.date | date:'shortTime' }}</span></div>
        <div class="meta-item"><mat-icon>location_on</mat-icon><span>{{ vm.event.location }}</span></div>
      </div>
    </div>

    <div class="sidebar">
      <mat-card>
        <mat-card-content>
          <div class="participants-info">
            <mat-icon>people</mat-icon>
            <h2>Participants ({{ vm.event.participants }} / {{ vm.event.capacity ?? 'Unlimited' }})</h2>
          </div>
          <ul class="participants-list">
            <li *ngFor="let name of vm.event.participantNames">{{ name }}</li>
            <li *ngIf="vm.event.participantNames?.length === 0" class="no-participants">No participants yet.</li>
          </ul>
        </mat-card-content>

        <div *ngIf="vm.isOrganizer" class="organizer-actions">
          <button mat-stroked-button color="primary" (click)="editEvent(vm.event.id)">
            <mat-icon>edit</mat-icon> Edit Event
          </button>
          <button mat-stroked-button color="warn" (click)="deleteEvent(vm.event.id)">
            <mat-icon>delete</mat-icon> Delete Event
          </button>
        </div>

        <mat-card-actions>
          <button *ngIf="vm.isFull" mat-flat-button disabled class="w-full full-btn">
            <mat-icon>block</mat-icon> <span>Full</span>
          </button>
          <button *ngIf="!vm.isFull && vm.isJoined" mat-stroked-button color="warn" class="w-full leave-btn" (click)="leave(vm.event.id)" [disabled]="vm.isActionInProgress">
            <mat-icon>logout</mat-icon> <span>Leave</span>
          </button>
          <button *ngIf="!vm.isFull && !vm.isJoined" mat-flat-button class="w-full join-btn" (click)="join(vm.event.id)" [disabled]="vm.isActionInProgress">
            <mat-icon>person_add</mat-icon> <span>Join Event</span>
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>

  <div *ngIf="!vm.isLoading && !vm.event" class="details-container not-found">
    <p>Event not found.</p>
    <a routerLink="/events">Back to events</a>
  </div>

</ng-container>