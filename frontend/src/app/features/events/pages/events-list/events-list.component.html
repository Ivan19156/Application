<!-- Використовуємо vm$ | async, щоб отримати весь стан компонента -->
<ng-container *ngIf="vm$ | async as vm">
  <div class="container mx-auto p-8">
    
    <!-- Заголовок сторінки -->
    <div class="header-section">
      <h1 class="text-4xl font-bold">Discover Events</h1>
      <p class="text-gray-600 mt-2 mb-6">
        Find and join exciting events happening near you
      </p>
    </div>

    <!-- Блок з фільтрами: пошук та теги -->
    <div class="filters-container">
      <!-- Поле для автоматичного пошуку -->
      <mat-form-field appearance="outline" class="search-input">
        <mat-icon matPrefix>search</mat-icon>
        <input 
          matInput 
          placeholder="Search events by name..."
          [formControl]="searchControl">
        <button 
          *ngIf="searchControl.value" 
          matSuffix 
          mat-icon-button 
          aria-label="Clear"
          (click)="clearSearch()">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>

      <!-- Компонент для фільтрації за тегами -->
      <app-tag-filter (selectionChange)="onTagSelectionChange($event)"></app-tag-filter>
    </div>

    <!-- Спінер для початкового завантаження -->
    <div *ngIf="vm.isLoading" class="loading-spinner">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Loading events...</p>
    </div>

    <!-- Основний контент, коли початкове завантаження завершено -->
    <div *ngIf="!vm.isLoading">
      <!-- Сітка з картками подій -->
      <div class="event-grid">
        <app-event-card 
          *ngFor="let event of vm.events; trackBy: trackByEventId" 
          [event]="event">
        </app-event-card>
      </div>

      <!-- Повідомлення, якщо нічого не знайдено -->
      <div *ngIf="vm.events.length === 0" class="no-results">
        <mat-icon>event_busy</mat-icon>
        <h3>No events found</h3>
        <!-- Показуємо цей текст, якщо є активний фільтр -->
        <p *ngIf="vm.hasActiveFilters">
          Try adjusting your search or filter criteria.
        </p>
        <!-- Показуємо цей текст, якщо фільтрів немає -->
        <p *ngIf="!vm.hasActiveFilters">
          There are no public events available at the moment. Why not create one?
        </p>
      </div>
    </div>
    
    <!-- Спінер для дозавантаження (нескінченний скрол) -->
    <div *ngIf="vm.isLoadingMore" class="loading-spinner">
      <mat-spinner diameter="30"></mat-spinner>
    </div>

  </div>
</ng-container>


